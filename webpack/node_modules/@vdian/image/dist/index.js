"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();!function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t){!function(t){void 0!==e&&e.exports?e.exports=t():window.image=t()}(function(){var e=[800,500,256,160,60],t=["si.geilicdn.com","sa.geilicdn.com","wd.geilicdn.com","img.geilicdn.com"],r=window.localStorage,n=/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/,a=["origin","protocol","slash","hostname","port","path","query","hash"],o={},i=function(){function e(t){var r=this;_classCallCheck(this,e);var o=n.exec(t);o&&a.forEach(function(e,t){r[e]=o[t]})}return _createClass(e,[{key:"extend",value:function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}},{key:"toString",value:function(){var e=(this.protocol?this.protocol:"https")+":"+this.slash+this.hostname;return this.port&&"80"!==this.port&&(e+=":"+this.port),this.path&&(e+="/"+this.path),this.query&&(e+=this.query),this.hash&&(e+="#"+this.hash),e}},{key:"getDomain",value:function(){var e=(this.protocol?this.protocol:"https")+":"+this.slash+this.hostname;return this.port&&"80"!==this.port&&(e+=":"+this.port),e}},{key:"params",get:function(){return o},set:function(e){if("object"==typeof e){for(var t in o)delete o[t];for(var t in e)o[t]=e[t]}}},{key:"query",get:function(){var e=[];for(var t in o)void 0!==o[t]&&(o[t]?e.push(encodeURIComponent(t)+"="+encodeURIComponent(o[t])):e.push(encodeURIComponent(t)));return e.length?"?"+e.join("&"):""},set:function(e){if("string"==typeof e){0===e.indexOf("?")&&(e=e.substr(1));var t=e.split("&");for(var r in o)delete o[r];for(var n=0;n<t.length;n++){var a=t[n].split("=");if(void 0!==a[1]&&(a[1]=a[1].toString()),a[0])try{o[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}catch(e){o[a[0]]=a[1]}}}}}]),e}();return{getDefaultOptions:function(){return{webp:!0,cache:!1,flex:!1}},detectWebp:function(){var e=document&&document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))&&0==e.toDataURL("image/webp").indexOf("data:image/webp")},getBestSize:function(t){var r=Math.max.apply(Math,e),n=Math.min.apply(Math,e),a=0;if(t=Number(t)){if(t>=r)return r;if(t<=n)return n;for(var o=1;o<e.length;o++){var i=e[o];if(t>=i){a=t==i?i:e[o-1];break}}return a}console.error("未设置图片尺寸")},validate:function(e){if(!e.url)return{code:1,message:"未设置图片地址"};if(e.best){if(!e.size)return{code:2,message:"未设置图片剪裁尺寸"}}else if(!e.w||!e.h)return{code:2,message:"未设置图片剪裁尺寸"};return{code:0}},getImageWithBestSize:function(e,t){var r=this.getDefaultOptions(),n=t;n.url=e,t.best=!0,void 0==t.webp&&(t.webp=r.webp),void 0==t.cache&&(t.cache=r.cache),void 0==t.flex&&(t.flex=r.flex);var a=this.validate(n);if(!a.code){return this.getImageUrl(e,t)}console.warn(a.message)},getImageWithCustomSize:function(e,t){var r=t,n=this.getDefaultOptions();r.url=e,t.best=!1,void 0==t.webp&&(t.webp=n.webp),void 0==t.cache&&(t.cache=n.cache),void 0==t.flex&&(t.flex=n.flex);var a=this.validate(r);if(!a.code){return this.getImageUrl(e,t)}console.warn(a.message)},getImageUrl:function(e,r){var n=new i(e);return-1==t.indexOf(n.hostname)?e:(n.hostname=this.handleHost(n.hostname),n.path=this.handleImageType(n.path,r),n.params=this.handleParams(r),r.best&&r.cache?this.getImageStorage(n):n.toString())},handleHost:function(e){var t=e;switch(e){case"wd.geilicdn.com":case"si.geilicdn.com":t="si.geilicdn.com"}return t},handleImageType:function(e,t){var r=this.detectWebp();return e.replace(/(\.(?:gif|jpg|jpeg|png|webp)(?:\.(?:jpg|png|webp))?)$/i,function(e){var n="",a="";switch(a=e){case".png.webp":case".jpg.webp":case".gif.webp":case".jpeg.webp":n=r&&t.webp?a:a.replace(".webp","");break;case".webp":n=r&&t.webp?a:".webp.jpg";break;case".png":case".jpg":case".JPG":case".jpeg":n=r&&t.webp?a+".webp":a;break;case".gif":n=a;break;default:n=a}return n})},handleParams:function(e){return e.best?this.getBestUrl(e):this.getCustomUrl(e)},getBestUrl:function(e){var t=e&&e.flex,r=Number(e&&e.size),n=this.getBestSize(r);return t?{w:800,h:800}:{w:n,h:n,cp:1}},getCustomUrl:function(e){var t=Number(e&&e.w),r=Number(e&&e.h);return e&&e.flex?{w:t,h:r}:{w:t,h:r,cp:1}},parseImageStorage:function(){var e=r.getItem("IMAGE_STORAGE");return e?JSON.parse(e):{}},getImageStorage:function(e){var t=e.path,r=e.params,n=this.parseImageStorage();if(n[t]){return this.compareParams(r,n[t])?(this.setImageStorage(e,n),e.toString()):this.getCacheUrl(e,n)}return this.setImageStorage(e,n),e.toString()},getCacheUrl:function(e,t){return e.params=t[e.path],e.toString()},setImageStorage:function(e,t){t[e.path]=e.params,r.setItem("IMAGE_STORAGE",JSON.stringify(t))},compareParams:function(e,t){return e.cp!=t.cp||e.w>t.w}}})}]);